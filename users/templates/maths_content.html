{% extends "base.html" %}

{% block title %}
    {% if content_data %}
        {{ content_data | first | upper }}
    {% else %}
        No Content Available
    {% endif %}
{% endblock %}

{% block body %}
<main class="my-5">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <p class="mt-5 lead" style="color: black;">Welcome to Grade 12 Support, the best place to learn and prepare for
                your final exams. We offer a wide range of content to help you prepare for your final exams. We have
                content for Maths and Science covering every topic. We also offer live classes and tutorials to help you
                understand the content better. We are here to help you succeed in your final exams.</p><br>
        </div>
        <div class="row row-cols-1 row-cols-md-3 g-4">
            {% if content_data %}
                {% for content_type, content_list in content_data.items() %}
                    <div class="col">
                        <div class="card h-100 mt-4">
                            <div class="card-body">
                                <h5 class="card-title text-center">{{ content_type|upper }}</h5>
                                <ul class="list-styled mt-4">
                                    {% set current_topic = None %}
                                    {% set current_subtopics = [] %}
                                    {% for content in content_list %}
                                        {% if current_topic != content.topic %}
                                            {% if current_subtopics %}
                                                <li class="mt-2">
                                                    {% for subtopic in current_subtopics %}
                                                        <a href="{{ subtopic.link }}">{{ subtopic.subtopic }}</a>{% if not loop.last %}, {% endif %}
                                                    {% endfor %}
                                                </li>
                                                {% set current_subtopics = [] %}
                                            {% endif %}
                                            <li class="mt-2">
                                                <h6>{{ content.topic }}</h6>
                                                <a href="{{ content.link }}">{{ content.subtopic }}</a>
                                                <form action="{{ url_for('users.increment_download', content_id=content.id) }}" method="GET" target="_blank" style="display: inline;">
                                                    <button type="submit" class="btn btn-sm btn-primary">Download</button>
                                                </form>
                                                <form action="{{ url_for('users.increment_view', content_id=content.id) }}" method="GET" style="display: inline;">
                                                    <button type="submit" class="btn btn-sm btn-info">View</button>
                                                </form>
                                            </li>
                                            {% set current_topic = content.topic %}
                                        {% else %}
                                            {% set _ = current_subtopics.append(content) %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if current_subtopics %}
                                        <li class="mt-2">
                                            {% for subtopic in current_subtopics %}
                                                <a href="{{ subtopic.link }}">{{ subtopic.subtopic }}</a>{% if not loop.last %}, {% endif %}
                                            {% endfor %}
                                        </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                {% include 'no_content.html' %}
            {% endif %}
        </div>
    </div>
</main>
{% endblock %}
